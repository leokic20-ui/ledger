<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ledger.OS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <link rel="apple-touch-icon" href="icon.png"> 
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        /* Base Setup */
        body { 
            background-color: #1a1a1a; 
            color: #ffffff; 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
        }
        
        * { touch-action: manipulation; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Neo-Brutalism Styles */
        .sticker-btn {
            background-color: #FF9900; color: black; border: 2px solid black;
            box-shadow: 4px 4px 0px 0px #000000;
            transition: all 0.1s; font-weight: 900; text-transform: uppercase;
        }
        .sticker-btn:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0px 0px #000000; }
        
        .sticker-dark {
            background-color: #333333; color: white; border: 2px solid black;
            box-shadow: 4px 4px 0px 0px #000000;
        }
        .sticker-dark:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0px 0px #000000; }

        .neo-card {
            background-color: #262626; border: 2px solid #333333;
            box-shadow: 4px 4px 0px 0px #000000; border-radius: 12px;
        }

        /* Hidden Input Trick */
        .hidden-date-input {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0; cursor: pointer; z-index: 10;
        }

        /* Inputs */
        input:not(.hidden-date-input), select {
            background: #1a1a1a; color: white; border: 2px solid #333333; outline: none; border-radius: 8px;
        }
        input:not(.hidden-date-input):focus, select:focus { border-color: #FF9900; }

        .pop-enter-active, .pop-leave-active { transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .pop-enter-from { opacity: 0; transform: scale(0.95); }
        .pop-leave-to { opacity: 0; transform: scale(1.05); display: none; }
        
        .safe-pb { padding-bottom: env(safe-area-inset-bottom); }
        .safe-pt { padding-top: env(safe-area-inset-top); }
    </style>
</head>
<body class="h-[100dvh] w-full overflow-hidden flex flex-col">

<div id="app" class="flex flex-col h-full w-full max-w-md mx-auto relative">

    <!-- HEADER -->
    <header class="safe-pt px-4 pt-4 pb-2 flex justify-between items-center bg-[#1a1a1a] border-b-2 border-[#333333] z-20 shrink-0">
        <h1 class="text-xl font-black tracking-tighter italic">LEDGER<span class="text-[#FF9900]">.OS</span></h1>
        <div class="flex items-center gap-2 bg-[#262626] px-2 py-1 rounded border border-[#333]">
            <div :class="syncStatusColor" class="w-2 h-2 rounded-full animate-pulse"></div>
            <span class="text-[10px] text-gray-400 font-mono">{{ currentView.toUpperCase() }}</span>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-1 overflow-y-auto overflow-x-hidden p-4 pb-28 no-scrollbar relative">
        <transition name="pop">
            
            <!-- VIEW 1: CALENDAR (Updated) -->
            <div v-if="currentView === 'calendar'" key="cal" class="space-y-4">
                <!-- Month Nav & Date Picker -->
                <div class="neo-card p-2 flex justify-between items-center bg-[#262626] relative">
                    <button @click="changeMonth(-1)" class="p-2 text-[#FF9900] font-black text-lg active:scale-90 z-20">‚óÄ</button>
                    
                    <!-- Middle Area: Clickable for Month Picker -->
                    <div class="relative flex-1 flex justify-center items-center h-full">
                        <span class="font-black text-xl tracking-wide border-b-2 border-dashed border-[#FF9900] pb-1">
                            {{ formatYearMonth(currentDate) }}
                        </span>
                        <!-- Hidden Month Picker covering the text -->
                        <input type="month" 
                               :value="currentYearMonthStr" 
                               @input="onMonthPick" 
                               class="hidden-date-input">
                    </div>

                    <button @click="changeMonth(1)" class="p-2 text-[#FF9900] font-black text-lg active:scale-90 z-20">‚ñ∂</button>
                </div>

                <!-- Calendar Grid -->
                <div class="neo-card p-2 bg-[#1a1a1a]">
                    <div class="grid grid-cols-7 mb-2 text-center">
                        <div v-for="d in ['S','M','T','W','T','F','S']" class="text-[10px] text-gray-500 font-bold">{{ d }}</div>
                    </div>
                    <div class="grid grid-cols-7 gap-1">
                        <div v-for="n in startDayOfWeek" :key="'empty'+n" class="h-10"></div>
                        <div v-for="day in daysInMonth" :key="day.dateStr" 
                             @click="selectDate(day.dateStr)"
                             class="h-10 relative flex items-center justify-center rounded-lg border border-transparent transition-all active:scale-90"
                             :class="dayClass(day)">
                            <span class="text-sm font-bold z-10">{{ day.dayNum }}</span>
                            <div v-if="hasTransaction(day.dateStr)" class="absolute bottom-1 w-1 h-1 rounded-full bg-[#FF9900]"></div>
                        </div>
                    </div>
                </div>

                <!-- Daily List -->
                <div class="space-y-2">
                    <div class="flex justify-between items-end border-b border-[#333] pb-1 px-1">
                        <span class="text-xs font-bold text-gray-400">{{ selectedDate }}</span>
                        <span class="font-mono font-bold text-[#FF9900]">${{ dayTotal }}</span>
                    </div>
                    <div v-if="filteredTransactions.length === 0" class="text-center py-6 text-gray-600 text-xs">No records.</div>
                    <div v-for="t in filteredTransactions" :key="t.id" @click="editTransaction(t)"
                         class="neo-card p-3 flex justify-between items-center active:scale-[0.98] transition-transform">
                        <div class="flex items-center gap-3">
                            <span class="text-xl">{{ getCategoryIcon(t.category) }}</span>
                            <div>
                                <div class="font-bold text-sm">{{ t.category }}</div>
                                <div class="text-[10px] text-gray-500">{{ t.account }} <span v-if="t.note">/ {{ t.note }}</span></div>
                            </div>
                        </div>
                        <div :class="['font-mono font-bold', t.type === 'expense' ? 'text-white' : 'text-[#FF9900]']">
                            {{ t.type === 'expense' ? '-' : '+' }}{{ t.amount }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW 2: ACCOUNTS (Updated with Date Filter) -->
            <div v-else-if="currentView === 'accounts'" key="acc" class="space-y-4">
                
                <!-- Net Worth Card with Date Picker -->
                <div class="relative neo-card p-5 bg-gradient-to-br from-[#FF9900] to-[#cc7a00] text-black border-none active:scale-[0.99] transition-transform">
                    <!-- Hidden Date Picker Overlay -->
                    <input type="month" v-model="accFilterDate" class="hidden-date-input">
                    
                    <div class="flex justify-between items-start">
                        <div class="text-[10px] font-black uppercase tracking-widest opacity-80 flex items-center gap-1">
                            Net Worth ({{ formatYearMonth(new Date(accFilterDate + '-01')) }}) ‚ñº
                        </div>
                        <div class="text-[10px] font-bold border border-black px-1 rounded">FILTER</div>
                    </div>
                    <div class="text-4xl font-black font-mono mt-2">${{ netWorthFiltered }}</div>
                    <div class="text-[10px] mt-1 opacity-70">Tap card to change month</div>
                </div>

                <!-- Account List (Showing REAL-TIME Balance, not filtered) -->
                <!-- User usually wants to see current wallet money regardless of history filter, 
                     but if you want filtered balance per account, we can apply it too. 
                     Here I assume "Accounts" list shows CURRENT ACTUAL MONEY, 
                     while Net Worth card shows "Performance of selected month". -->
                <div class="grid gap-3">
                     <div class="text-[10px] text-gray-500 font-bold uppercase ml-1">Current Balances (Real-time)</div>
                    <div v-for="acc in accounts" :key="acc.name" class="neo-card p-4 flex justify-between items-center bg-[#262626]">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">{{ acc.icon }}</span>
                            <span class="font-bold">{{ acc.name }}</span>
                        </div>
                        <span class="font-mono text-lg font-bold">${{ getAccountBalance(acc.name) }}</span>
                    </div>
                </div>
            </div>

            <!-- VIEW 3: CHARTS -->
            <div v-else-if="currentView === 'charts'" key="chart" class="space-y-4">
                <div class="neo-card p-4 bg-[#262626] h-64 relative">
                    anvas id="expenseChart"></canvas>
                </div>
                <div class="space-y-2 pb-4">
                    <div v-for="(stat, index) in categoryStats" :key="stat.name" class="flex justify-between items-center p-2 border-b border-[#333]">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full shadow" :style="{backgroundColor: chartColors[index % chartColors.length]}"></div>
                            <span class="text-xl">{{ stat.icon }}</span>
                            <span class="font-bold text-xs">{{ stat.name }}</span>
                        </div>
                        <div class="font-mono text-sm">${{ stat.total }} <span class="text-gray-500 text-[10px]">({{ stat.percent }}%)</span></div>
                    </div>
                </div>
            </div>

            <!-- VIEW 4: SETTINGS -->
            <div v-else-if="currentView === 'settings'" key="set" class="space-y-6">
                <div class="neo-card p-4 bg-[#262626]">
                    <h3 class="text-[#FF9900] font-black text-sm mb-3 uppercase flex items-center gap-2"><span>üîÑ</span> Fixed Monthly Items</h3>
                    <div v-for="(item, idx) in fixedItems" :key="idx" class="flex justify-between items-center bg-[#1a1a1a] p-2 rounded mb-2 border border-[#333]">
                        <div>
                            <div class="font-bold text-xs">{{ item.category }} (${{ item.amount }})</div>
                            <div class="text-[10px] text-gray-500">{{ item.type }} ‚Ä¢ {{ item.note }}</div>
                        </div>
                        <button @click="removeFixedItem(idx)" class="text-red-500 font-bold px-2">√ó</button>
                    </div>
                    <div class="mt-3 pt-3 border-t border-[#333] space-y-2">
                        <div class="flex gap-2">
                            <select v-model="newFixed.type" class="w-1/3 text-xs p-2"><option value="expense">Exp</option><option value="income">Inc</option></select>
                            <input v-model.number="newFixed.amount" placeholder="$" class="w-2/3 text-xs p-2 font-mono">
                        </div>
                        <div class="flex gap-2">
                            <select v-model="newFixed.category" class="w-1/2 text-xs p-2"><option v-for="c in categories" :value="c.name">{{ c.name }}</option></select>
                            <input v-model="newFixed.note" placeholder="Note" class="w-1/2 text-xs p-2">
                        </div>
                        <button @click="addFixedItem" class="sticker-dark w-full py-2 text-xs font-bold rounded mt-2">ADD FIXED ITEM</button>
                    </div>
                </div>
                <div class="neo-card p-4 bg-[#262626]">
                    <button @click="exportJSON" class="sticker-dark w-full py-3 rounded font-bold text-sm">EXPORT JSON BACKUP</button>
                    <div class="text-[10px] text-gray-600 text-center mt-2 font-mono">UID: {{ userId ? userId.slice(0,8) : '...' }}</div>
                </div>
            </div>
        </transition>
    </main>

    <!-- FAB -->
    <button @click="openAddModal" class="absolute bottom-24 right-5 w-16 h-16 rounded-full sticker-btn flex items-center justify-center z-30 text-4xl pb-1">+</button>

    <!-- NAV -->
    <nav class="safe-pb bg-[#1a1a1a] border-t-2 border-[#333333] h-20 shrink-0 flex justify-around items-center z-20">
        <button v-for="v in ['calendar', 'accounts', 'charts', 'settings']" @click="currentView = v" class="flex flex-col items-center justify-center w-16 h-full transition-all active:scale-90">
            <span class="text-2xl mb-1 filter drop-shadow-md" :class="currentView === v ? 'opacity-100 scale-110' : 'opacity-40 grayscale'">{{ {calendar:'üìÖ', accounts:'üí≥', charts:'üìä', settings:'‚öôÔ∏è'}[v] }}</span>
            <span class="text-[9px] font-black uppercase tracking-wider" :class="currentView === v ? 'text-[#FF9900]' : 'text-gray-600'">{{ v }}</span>
        </button>
    </nav>

    <!-- MODAL -->
    <div v-if="showModal" class="fixed inset-0 bg-black/90 z-50 flex items-end justify-center backdrop-blur-sm safe-pb">
        <div @click="closeModal" class="absolute inset-0"></div>
        <div class="bg-[#1a1a1a] w-full max-w-md rounded-t-3xl border-t-4 border-[#FF9900] p-6 space-y-4 relative card-shadow mb-4 mx-2">
            <div class="flex justify-between items-center mb-2">
                <h3 class="font-black text-xl italic">{{ isEditing ? 'EDIT' : 'NEW' }} ENTRY</h3>
                <button @click="closeModal" class="text-2xl text-gray-500 w-8 h-8 flex items-center justify-center bg-[#262626] rounded-full">√ó</button>
            </div>
            <div class="flex bg-[#262626] p-1 rounded-xl border border-[#333]">
                <button @click="form.type = 'expense'" :class="['flex-1 py-3 rounded-lg font-black text-sm transition-all', form.type === 'expense' ? 'bg-[#333] text-white shadow-sm' : 'text-gray-500']">EXPENSE</button>
                <button @click="form.type = 'income'" :class="['flex-1 py-3 rounded-lg font-black text-sm transition-all', form.type === 'income' ? 'bg-[#333] text-[#FF9900] shadow-sm' : 'text-gray-500']">INCOME</button>
            </div>
            <div class="relative">
                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-[#FF9900] font-black text-2xl">$</span>
                <input v-model.number="form.amount" type="number" inputmode="decimal" placeholder="0" class="w-full py-4 pl-10 pr-4 text-4xl font-mono font-bold rounded-xl text-right bg-[#262626] border-2 border-[#333] focus:border-[#FF9900]">
            </div>
            <div class="grid grid-cols-4 gap-2 max-h-32 overflow-y-auto no-scrollbar py-1">
                <button v-for="cat in categories" @click="form.category = cat.name" :class="['flex flex-col items-center justify-center p-2 rounded-xl border-2 transition-all active:scale-95', form.category === cat.name ? 'border-[#FF9900] bg-[#262626]' : 'border-transparent bg-[#1a1a1a]']">
                    <span class="text-2xl mb-1">{{ cat.icon }}</span>
                    <span class="text-[9px] font-bold uppercase truncate w-full text-center">{{ cat.name }}</span>
                </button>
            </div>
            <div class="grid grid-cols-2 gap-3">
                <select v-model="form.account" class="p-3 rounded-xl font-bold text-xs uppercase bg-[#262626]"><option v-for="acc in accounts" :value="acc.name">{{ acc.name }}</option></select>
                <input v-model="form.date" type="date" class="p-3 rounded-xl font-mono text-xs bg-[#262626]">
            </div>
            <input v-model="form.note" type="text" placeholder="Add a note..." class="w-full p-3 rounded-xl text-xs bg-[#262626]">
            <div class="flex gap-3 pt-2">
                <button v-if="isEditing" @click="deleteTransaction" class="flex-1 py-4 bg-red-900/30 text-red-500 font-black rounded-xl border-2 border-red-900 active:scale-95 transition-transform">DEL</button>
                <button @click="saveTransaction" class="flex-[2] py-4 bg-[#FF9900] text-black font-black rounded-xl border-2 border-black shadow-[4px_4px_0px_black] active:translate-y-1 active:shadow-none transition-all text-lg">CONFIRM</button>
            </div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyAgQ5MJpg6r6fo94OWGgQVQcqa--awmNVY",
      authDomain: "my-ledger-app-3e089.firebaseapp.com",
      projectId: "my-ledger-app-3e089",
      storageBucket: "my-ledger-app-3e089.firebasestorage.app",
      messagingSenderId: "119116668732",
      appId: "1:119116668732:web:df7a535b9ec4b25a8ec839"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            const currentView = ref('calendar');
            const currentDate = ref(new Date());
            const selectedDate = ref(new Date().toISOString().split('T')[0]);
            const transactions = ref([]);
            const userId = ref(null);
            const syncStatusColor = ref('bg-red-500');
            const showModal = ref(false);
            const isEditing = ref(false);
            const editingId = ref(null);
            const fixedItems = ref([]);
            const newFixed = ref({ type: 'expense', amount: '', category: 'Food', note: '' });
            const chartColors = ['#FF9900', '#00CED1', '#FF69B4', '#9370DB', '#4169E1', '#FFD700', '#32CD32', '#FF4500'];
            const accounts = ref([{ name: 'Bank', icon: 'üè¶' }, { name: 'Cash', icon: 'üíµ' }, { name: 'Credit', icon: 'üí≥' }, { name: 'Octopus', icon: 'üêô' }]);
            const categories = [{ name: 'Food', icon: 'üçî' }, { name: 'Transport', icon: 'üöå' }, { name: 'Shopping', icon: 'üõçÔ∏è' }, { name: 'Ent.', icon: 'üé¨' }, { name: 'Bills', icon: 'üßæ' }, { name: 'Salary', icon: 'üí∞' }, { name: 'Travel', icon: '‚úàÔ∏è' }, { name: 'Health', icon: 'üíä' }];
            const form = ref({ type: 'expense', amount: '', category: 'Food', account: 'Cash', date: '', note: '' });

            // Account Filter State (Default to current month)
            const accFilterDate = ref(new Date().toISOString().slice(0, 7));

            // Calendar Computed
            const currentYearMonthStr = computed(() => currentDate.value.toISOString().slice(0, 7));
            const startDayOfWeek = computed(() => { const d = new Date(currentDate.value); d.setDate(1); return d.getDay(); });
            const daysInMonth = computed(() => {
                const year = currentDate.value.getFullYear();
                const month = currentDate.value.getMonth();
                const days = new Date(year, month + 1, 0).getDate();
                return Array.from({length: days}, (_, i) => ({ 
                    dayNum: i + 1, 
                    dateStr: new Date(year, month, i + 1).toISOString().split('T')[0] 
                }));
            });

            // Transaction Filter
            const filteredTransactions = computed(() => transactions.value.filter(t => t.date === selectedDate.value));
            const dayTotal = computed(() => filteredTransactions.value.reduce((s, t) => t.type === 'expense' ? s - t.amount : s + t.amount, 0));

            // Net Worth Filtered
            const netWorthFiltered = computed(() => {
                const targetMonth = accFilterDate.value; // e.g., "2026-01"
                return transactions.value
                    .filter(t => t.date.startsWith(targetMonth))
                    .reduce((sum, t) => t.type === 'income' ? sum + t.amount : sum - t.amount, 0);
            });

            // Account Balance (Real-time, All-time)
            const getAccountBalance = (accName) => {
                return transactions.value
                    .filter(t => t.account === accName)
                    .reduce((acc, t) => t.type === 'income' ? acc + t.amount : acc - t.amount, 0);
            };

            const categoryStats = computed(() => {
                const s = {};
                transactions.value.filter(t => t.type === 'expense').forEach(t => { s[t.category] = (s[t.category] || 0) + t.amount; });
                const total = Object.values(s).reduce((a, b) => a + b, 0);
                return Object.entries(s).map(([n, v]) => ({ name: n, total: v, icon: categories.find(c => c.name === n)?.icon || '?', percent: total ? Math.round(v/total*100) : 0 })).sort((a,b) => b.total - a.total);
            });

            // Methods
            const dayClass = (day) => {
                if (selectedDate.value === day.dateStr) return 'bg-[#FF9900] text-black border-black shadow-[2px_2px_0px_black]';
                if (day.dateStr === new Date().toISOString().split('T')[0]) return 'border-[#FF9900] text-[#FF9900]';
                return 'bg-[#262626] text-gray-300';
            };

            const onMonthPick = (e) => {
                const [y, m] = e.target.value.split('-');
                currentDate.value = new Date(y, m - 1, 1);
            };

            const initAuth = () => auth.onAuthStateChanged(async user => { if (user) { userId.value = user.uid; syncStatusColor.value = 'bg-green-500'; loadData(); loadFixedItems(); } else { await auth.signInAnonymously(); } });
            const loadData = () => db.collection('users').doc(userId.value).collection('transactions').orderBy('date', 'desc').onSnapshot(s => transactions.value = s.docs.map(d => ({ id: d.id, ...d.data() })));
            const loadFixedItems = () => db.collection('users').doc(userId.value).collection('fixedItems').onSnapshot(s => fixedItems.value = s.docs.map(d => ({ id: d.id, ...d.data() })));
            
            const saveTransaction = async () => {
                if (!form.value.amount || !userId.value) return;
                const d = { ...form.value };
                try { isEditing.value ? await db.collection('users').doc(userId.value).collection('transactions').doc(editingId.value).update(d) : await db.collection('users').doc(userId.value).collection('transactions').add(d); closeModal(); } catch (e) { alert(e.message); }
            };
            
            const deleteTransaction = async () => { if (confirm("Delete?")) { await db.collection('users').doc(userId.value).collection('transactions').doc(editingId.value).delete(); closeModal(); } };
            const addFixedItem = async () => { if (!newFixed.value.amount) return; await db.collection('users').doc(userId.value).collection('fixedItems').add(newFixed.value); newFixed.value.amount = ''; };
            const removeFixedItem = async (idx) => await db.collection('users').doc(userId.value).collection('fixedItems').doc(fixedItems.value[idx].id).delete();
            const exportJSON = () => { const a = document.createElement("a"); a.href = URL.createObjectURL(new Blob([JSON.stringify(transactions.value, null, 2)], { type: "application/json" })); a.download = `ledger_backup.json`; a.click(); };
            
            let chart = null;
            const renderChart = () => {
                const ctx = document.getElementById('expenseChart');
                if (!ctx) return;
                if (chart) chart.destroy();
                chart = new Chart(ctx, {
                    type: 'doughnut',
                    data: { labels: categoryStats.value.map(s => s.name), datasets: [{ data: categoryStats.value.map(s => s.total), backgroundColor: chartColors, borderWidth: 0 }] },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, cutout: '70%', layout: { padding: 20 } }
                });
            };

            onMounted(initAuth);
            watch(currentView, v => v === 'charts' && setTimeout(renderChart, 200));

            return {
                currentView, currentDate, selectedDate, transactions, accounts, categories, daysInMonth, filteredTransactions, dayTotal, netWorthFiltered, categoryStats, syncStatusColor, userId, showModal, isEditing, form, startDayOfWeek, chartColors, accFilterDate, fixedItems, newFixed, currentYearMonthStr,
                changeMonth: (o) => { const d = new Date(currentDate.value); d.setMonth(d.getMonth() + o); currentDate.value = d; },
                selectDate: (d) => selectedDate.value = d,
                formatYearMonth: (d) => d.toLocaleString('default', { month: 'short', year: 'numeric' }),
                getCategoryIcon: (n) => categories.find(c => c.name === n)?.icon || 'üì¶',
                getAccountBalance, onMonthPick,
                openAddModal: () => { isEditing.value = false; form.value = { type: 'expense', amount: '', category: 'Food', account: 'Cash', date: selectedDate.value, note: '' }; showModal.value = true; },
                editTransaction: (t) => { isEditing.value = true; editingId.value = t.id; form.value = { ...t }; showModal.value = true; },
                closeModal: () => showModal.value = false,
                saveTransaction, deleteTransaction, addFixedItem, removeFixedItem, dayClass, hasTransaction: (d) => transactions.value.some(t => t.date === d), exportJSON
            };
        }
    }).mount('#app');
</script>
</body>
</html>
